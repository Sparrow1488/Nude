<mxfile host="Electron" modified="2023-04-08T08:43:20.318Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.1.2 Chrome/106.0.5249.199 Electron/21.4.3 Safari/537.36" etag="1AfDdGVVSKJk2X-H8SdW" version="21.1.2" type="device">
  <diagram id="prtHgNgQTEPvFCAcTncT" name="Page-1">
    <mxGraphModel dx="1861" dy="1728" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="JIjteD26HdvMNrANgCVM-1" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="320" y="100" width="340" height="330" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-2" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;Nude Solution&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="400" y="60" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-3" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;API Gateway&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="330" y="370" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-5" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="330" y="110" width="320" height="130" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-6" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;Background Workers&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="390" y="110" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-7" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;Content Receiver&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="140" width="140" height="90" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-8" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;Content Converter&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="340" y="140" width="140" height="90" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-9" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;Nude&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="330" y="250" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-10" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="310" y="550" width="360" height="195" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-11" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;Database Infrastructure&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="330" y="310" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-12" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;Host&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="321" y="695" width="340" height="40" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-13" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;Nude Telegram Solution&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="352" y="510" width="276" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-14" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;NotifyService&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="321" y="645" width="165" height="40" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-15" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;Callback&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="495" y="645" width="165" height="40" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-17" value="NudeApiClient" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="316" y="560" width="350" height="80" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-18" value="NudeUserManager" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="320" y="570" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-19" value="ContentTicket" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-40" y="120" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-21" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;Nude Entities&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="60" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-23" value="Manga" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-20" y="160" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-25" value="other..." style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="136" y="160" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-26" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;Nude Telegram Entities&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-2" y="510" width="276" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-27" value="UserMessage" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-14" y="570" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-28" value="User" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-20" y="200" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-29" value="Account" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-20" y="240" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-30" value="Subscriptions (feat)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-20" y="280" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-31" value="&lt;span style=&quot;font-size: 24px;&quot;&gt;Nude API Endpoints&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="930" y="60" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-33" value="&lt;font face=&quot;Tahoma&quot; style=&quot;font-size: 18px;&quot;&gt;Manga Endpoint&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="920" y="100" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-34" value="&lt;font face=&quot;Tahoma&quot; style=&quot;font-size: 18px;&quot;&gt;Content Request Controller&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="920" y="160" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-35" value="&lt;pre&gt;&lt;font face=&quot;Tahoma&quot; style=&quot;font-size: 18px;&quot;&gt;&lt;i&gt;Account Controller&lt;/i&gt;&lt;/font&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="920" y="220" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-37" value="&lt;h1&gt;Manga Controller&lt;/h1&gt;&lt;p&gt;Дает доступ к базе данных с мангой NudeDB. Также может осуществлять поиск манги по названию, тегам, автору и прочему (в запросе передаются параметры для поиска, а также какой контент исключить из поиска)&lt;/p&gt;&lt;p&gt;Имеет отдельный роут &lt;i&gt;/{id}/meta&lt;/i&gt;, чтобы получить дополнительную информацию о состоянии манги (существует ли, есть ли у пользователя доступ к ней). Также можно получать мету манги не только по Id, но и по SourceId и Source.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Примечание&lt;/b&gt;: в мете также можно увидеть информацию о том, висит ли запрос на ее получение в БД (необходимо ли создавать его или можно подписаться на сущестувующий)&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1270" y="-240" width="280" height="300" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-38" value="&lt;h1&gt;Content Request Controller&lt;/h1&gt;&lt;p&gt;Позволяет оставить запрос (посмотреть состояние и прочую информацию) на получение содержимого с определенного интернет ресурса, будь то манга, картинки, видосики или прочее.&lt;/p&gt;&lt;p&gt;Но может выбросить 400 в случае, если указанный пользователем ресурс не поддерживается. Для получения списка доступных ресурсов воспользуйтесь роутом: &lt;i&gt;/external/available&lt;/i&gt;&lt;/p&gt;&lt;p&gt;После создания запроса, для пользователя создастся подписка на отслеживание его состояния. По этим подпискам пользователь сможет получать свои текущие запросы, а также, в случае надобности, отменять их.&lt;/p&gt;&lt;p&gt;При подписке на существующий запрос, пользователь сможет указать в параметрах callback uri и выбрать тип состояния, об изменении которого его необходимо уведомить запросом на указанный адрес.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Примечание&lt;/b&gt;: если на запросе не будет подписан ни один пользователь, то он получает минимальный приоритет и будет обработан в последнюю очередь.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Примечание&lt;/b&gt;: если пользователь отправляет запрос на получение содержимого с ресурса, но подобный ему уже существует, то пользователя подписывают на уже существующий запрос&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1590" y="-240" width="340" height="460" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-39" value="&lt;h1&gt;Accounts Controller&lt;/h1&gt;&lt;p&gt;Поскольку мы хотим монетизировать данную штуку, необходимо идентифицировать крутых и обычных пользаков. Поэтому на сервере будут вводиться ограничения на использование ресурсов и будет ставиться приоритет на обработку запросов в зависимости от статуса пользователя.&lt;/p&gt;&lt;p&gt;Всего будет четыре типа пользователей, это &lt;b&gt;гости&lt;/b&gt;,&amp;nbsp;&lt;b&gt;обычные&lt;/b&gt;, &lt;b&gt;вип&lt;/b&gt; и &lt;b&gt;админы&lt;/b&gt;. Про ограничения распишу потом.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Примечание&lt;/b&gt;: аккаунт гостя создается по принципу аккаунтов Телеграф (вводишь имя, получаешь токен, который тебя идентифицирует, если надо - обновляешь его).&lt;/p&gt;&lt;p&gt;&lt;b&gt;Заметка&lt;/b&gt;: нужно отслеживать создание гостевых аккаунтов (по IP), что банить нахуй читеров, ебать, самые умные чтоли&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2000" y="-240" width="280" height="430" as="geometry" />
        </mxCell>
        <mxCell id="JIjteD26HdvMNrANgCVM-40" value="ContentFormatTicket" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="136" y="120" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="XsfaPb-UnEtbQW3U9azf-2" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="700" y="550" width="340" height="150" as="geometry" />
        </mxCell>
        <mxCell id="XsfaPb-UnEtbQW3U9azf-3" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;Nude.Bot.Tg Host&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="910" y="555" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="XsfaPb-UnEtbQW3U9azf-4" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;Telegram Handlers&amp;nbsp;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="710" y="650" width="320" height="45" as="geometry" />
        </mxCell>
        <mxCell id="XsfaPb-UnEtbQW3U9azf-5" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;Endpoints&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="710" y="595" width="320" height="45" as="geometry" />
        </mxCell>
        <mxCell id="XsfaPb-UnEtbQW3U9azf-6" value="Resolver" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="960" y="610" width="60" height="70" as="geometry" />
        </mxCell>
        <mxCell id="XsfaPb-UnEtbQW3U9azf-9" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="JIjteD26HdvMNrANgCVM-12" target="XsfaPb-UnEtbQW3U9azf-2">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="795" as="sourcePoint" />
            <mxPoint x="750" y="745" as="targetPoint" />
            <Array as="points">
              <mxPoint x="870" y="715" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
